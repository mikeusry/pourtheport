---
export interface Props {
  measurementId?: string;
}

const { measurementId = import.meta.env.PUBLIC_GA_MEASUREMENT_ID } = Astro.props;

// Only load analytics in production or when explicitly enabled
const isProduction = import.meta.env.PROD;
const isDevelopment = import.meta.env.DEV;
const enableAnalytics = measurementId && (isProduction || import.meta.env.PUBLIC_GA_DEBUG === 'true');
---

{enableAnalytics && (
  <>
    <!-- Google tag (gtag.js) -->
    <script async src={`https://www.googletagmanager.com/gtag/js?id=${measurementId}`}></script>
    <script is:inline define:vars={{ measurementId }}>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      
      // Configure GA4 with enhanced settings
      gtag('config', measurementId, {
        // Enhanced ecommerce and user engagement
        send_page_view: true,
        allow_google_signals: true,
        allow_ad_personalization_signals: true,
        
        // Custom parameters for septic treatment business
        custom_map: {
          'custom_parameter_1': 'subscription_type',
          'custom_parameter_2': 'treatment_frequency'
        },
        
        // Enhanced conversion tracking
        enhanced_conversions: true,
        
        // Debug mode for development
        debug_mode: window.location.hostname === 'localhost'
      });

      // Track page views with custom dimensions
      gtag('event', 'page_view', {
        page_title: document.title,
        page_location: window.location.href,
        content_group1: 'Pour the PORT Landing Page'
      });

      // Custom event for septic treatment interests
      gtag('event', 'audience_engagement', {
        event_category: 'septic_treatment',
        event_label: 'landing_page_visit',
        content_group1: 'septic_maintenance'
      });
    </script>
  </>
)}

{isDevelopment && !enableAnalytics && (
  <script is:inline>
    console.log('üîç Google Analytics: Disabled in development mode');
    console.log('üí° To enable: Set PUBLIC_GA_MEASUREMENT_ID and PUBLIC_GA_DEBUG=true in .env');
  </script>
)}