---
export interface Props {
  measurementId?: string;
}

const { measurementId = import.meta.env.PUBLIC_GA_MEASUREMENT_ID } = Astro.props;

// Only load analytics in production or when explicitly enabled
const isProduction = import.meta.env.PROD;
const isDevelopment = import.meta.env.DEV;
const enableAnalytics = measurementId && measurementId !== 'your-ga4-measurement-id-here' && (isProduction || import.meta.env.PUBLIC_GA_DEBUG === 'true');
---

{enableAnalytics ? (
  <>
    <!-- Google tag (gtag.js) -->
    <script async src={`https://www.googletagmanager.com/gtag/js?id=${measurementId}`}></script>
    <script is:inline define:vars={{ measurementId }}>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      
      // Configure GA4 with basic settings that work reliably
      gtag('config', measurementId, {
        send_page_view: true,
        allow_google_signals: true,
        enhanced_conversions: true
      });

      // Initialize confirmation
      console.log('üìä Google Analytics 4 initialized:', measurementId);
    </script>
  </>
) : (
  <script is:inline>
    if (window.location.hostname === 'localhost') {
      console.log('üîç Google Analytics: Disabled in development mode');
      console.log('üí° To enable: Set PUBLIC_GA_DEBUG=true in .env');
    }
  </script>
)}