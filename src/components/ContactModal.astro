---
export interface Props {
  triggerId?: string;
}

const { triggerId = 'contact-modal-trigger' } = Astro.props;
---

<!-- Contact Modal -->
<div id="contact-modal" class="modal-overlay hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
  <div class="modal-content bg-white rounded-2xl shadow-2xl max-w-md w-full max-h-[90vh] overflow-y-auto transform transition-all duration-300 scale-95">
    
    <!-- Modal Header -->
    <div class="bg-gradient-to-r from-green-500 to-green-600 text-white p-6 rounded-t-2xl relative">
      <button id="close-modal" class="absolute top-4 right-4 text-white hover:text-gray-200 transition-colors">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
      <h2 class="text-2xl font-bold mb-2">Get Expert Help</h2>
      <p class="text-green-100">Our septic system experts are here to help with personalized advice.</p>
    </div>

    <!-- Modal Body -->
    <div class="p-6">
      
      <!-- Contact Options -->
      <div class="grid grid-cols-1 gap-4 mb-6">
        
        <!-- Phone Option -->
        <div class="flex items-center p-4 bg-blue-50 border border-blue-200 rounded-lg hover:bg-blue-100 transition-colors">
          <div class="bg-blue-500 text-white p-3 rounded-full mr-4">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
            </svg>
          </div>
          <div class="flex-1">
            <h3 class="font-semibold text-gray-900">Call Our Experts</h3>
            <p class="text-sm text-gray-600 mb-2">Speak directly with a septic specialist</p>
            <a href="tel:18006083755" class="text-blue-600 font-bold text-lg hover:text-blue-700">1-800-608-3755</a>
          </div>
        </div>

        <!-- Email Divider -->
        <div class="text-center text-gray-500">
          <span class="bg-white px-3 relative z-10">or</span>
          <div class="border-t border-gray-200 absolute left-0 right-0 top-1/2 -z-0"></div>
        </div>

      </div>

      <!-- Email Form -->
      <form id="contact-form" class="space-y-4">
        <div>
          <label for="customer-name" class="block text-sm font-medium text-gray-700 mb-2">Your Name</label>
          <input 
            type="text" 
            id="customer-name" 
            name="name" 
            required
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors"
            placeholder="Enter your full name"
          >
        </div>

        <div>
          <label for="customer-email" class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
          <input 
            type="email" 
            id="customer-email" 
            name="email" 
            required
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors"
            placeholder="your@email.com"
          >
        </div>

        <div>
          <label for="customer-phone" class="block text-sm font-medium text-gray-700 mb-2">Phone Number (Optional)</label>
          <input 
            type="tel" 
            id="customer-phone" 
            name="phone"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors"
            placeholder="(555) 123-4567"
          >
        </div>

        <div>
          <label for="septic-issue" class="block text-sm font-medium text-gray-700 mb-2">Describe Your Septic Situation</label>
          <textarea 
            id="septic-issue" 
            name="message" 
            rows="4" 
            required
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors resize-vertical"
            placeholder="Tell us about your septic system, any issues you're experiencing, or questions you have..."
          ></textarea>
        </div>

        <!-- Form Status Messages -->
        <div id="form-status" class="hidden"></div>

        <!-- Submit Button -->
        <button 
          type="submit" 
          id="submit-btn"
          class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg transition-all duration-300 transform hover:scale-105 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
        >
          <span id="submit-text">Send Message to Expert</span>
          <span id="submit-loading" class="hidden">
            <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            Sending...
          </span>
        </button>
      </form>

      <!-- Privacy Notice -->
      <p class="text-xs text-gray-500 mt-4 text-center">
        Your information is secure and will only be used to provide septic system guidance. 
        We respect your privacy and never share personal details.
      </p>

    </div>
  </div>
</div>

<script>
  // Modal functionality
  const modal = document.getElementById('contact-modal');
  const closeBtn = document.getElementById('close-modal');
  const form = document.getElementById('contact-form');
  const submitBtn = document.getElementById('submit-btn');
  const submitText = document.getElementById('submit-text');
  const submitLoading = document.getElementById('submit-loading');
  const formStatus = document.getElementById('form-status');

  // Open modal function (can be called from anywhere)
  window.openContactModal = function() {
    modal?.classList.remove('hidden');
    document.body.style.overflow = 'hidden';
    setTimeout(() => {
      const modalContent = modal?.querySelector('.modal-content');
      modalContent?.classList.remove('scale-95');
      modalContent?.classList.add('scale-100');
    }, 10);
  };

  // Close modal function
  function closeModal() {
    const modalContent = modal?.querySelector('.modal-content');
    modalContent?.classList.remove('scale-100');
    modalContent?.classList.add('scale-95');
    setTimeout(() => {
      modal?.classList.add('hidden');
      document.body.style.overflow = '';
    }, 300);
  }

  // Event listeners
  closeBtn?.addEventListener('click', closeModal);
  
  modal?.addEventListener('click', (e) => {
    if (e.target === modal) closeModal();
  });

  // Escape key to close
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && !modal?.classList.contains('hidden')) {
      closeModal();
    }
  });

  // Form submission
  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    // Get form data
    const formData = new FormData(form);
    const data = {
      name: formData.get('name'),
      email: formData.get('email'),
      phone: formData.get('phone'),
      message: formData.get('message'),
      subject: 'Septic System Expert Help Request - Pour the PORT',
      to: 'success@southlandorganics.com'
    };

    // Show loading state
    submitBtn.disabled = true;
    submitText?.classList.add('hidden');
    submitLoading?.classList.remove('hidden');

    try {
      // Here you would integrate with your email service
      // For now, we'll simulate the email sending
      await simulateEmailSend(data);
      
      // Show success message
      showStatus('success', 'Message sent successfully! Our expert will contact you within 24 hours.');
      
      // Reset form
      form.reset();
      
      // Close modal after delay
      setTimeout(() => {
        closeModal();
      }, 2000);
      
    } catch (error) {
      console.error('Error sending email:', error);
      showStatus('error', 'Sorry, there was an error sending your message. Please try calling us at 1-800-608-3755.');
    } finally {
      // Reset button state
      submitBtn.disabled = false;
      submitText?.classList.remove('hidden');
      submitLoading?.classList.add('hidden');
    }
  });

  function showStatus(type, message) {
    const statusEl = formStatus;
    if (!statusEl) return;
    
    statusEl.className = `p-3 rounded-lg text-sm ${
      type === 'success' 
        ? 'bg-green-50 border border-green-200 text-green-800' 
        : 'bg-red-50 border border-red-200 text-red-800'
    }`;
    statusEl.textContent = message;
    statusEl.classList.remove('hidden');
  }

  // Simulate email sending (replace with actual email service)
  async function simulateEmailSend(data) {
    // In production, you would integrate with:
    // - Netlify Forms
    // - Vercel Functions
    // - EmailJS
    // - Your backend API
    
    console.log('Email data:', data);
    
    // Simulate API call delay
    await new Promise(resolve => setTimeout(resolve, 1500));
    
    // For demo purposes, we'll just log the data
    // In production, this would make an actual API call
    return { success: true };
  }
</script>

<style>
  .modal-overlay {
    backdrop-filter: blur(4px);
  }
  
  .modal-content {
    animation: modalSlideIn 0.3s ease-out;
  }
  
  @keyframes modalSlideIn {
    from {
      opacity: 0;
      transform: translateY(-50px) scale(0.95);
    }
    to {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }
</style>