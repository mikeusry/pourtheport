---
export interface Props {
  variantId?: string;
  quantity?: number;
  text?: string;
  class?: string;
  size?: 'sm' | 'md' | 'lg' | 'xl';
  style?: 'primary' | 'secondary';
  loading?: boolean;
  sellingPlan?: string;
}

const {
  variantId = '42616731533557', // Default to the working variant ID
  quantity = 1,
  text = 'Add to Cart',
  class: className = '',
  size = 'lg',
  style = 'primary',
  loading = false,
  sellingPlan = '4238246133' // Default to the working selling plan ID
} = Astro.props;

// Size variations
const sizeClasses = {
  sm: 'py-2 px-4 text-sm',
  md: 'py-3 px-6 text-base',
  lg: 'py-4 px-8 text-lg',
  xl: 'py-5 px-10 text-xl'
};

// Style variations
const styleClasses = {
  primary: 'bg-green-500 hover:bg-green-600 text-white',
  secondary: 'bg-white border-2 border-green-500 text-green-600 hover:bg-green-50'
};

const buttonClasses = `
  ${styleClasses[style]} 
  ${sizeClasses[size]} 
  font-bold rounded-full transition-all duration-300 transform hover:scale-105 shadow-lg 
  disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none
  inline-flex items-center justify-center
  ${className}
`;

// Extract numeric ID from GraphQL ID if needed
const numericVariantId = variantId.includes('gid://shopify/ProductVariant/') 
  ? variantId.split('/').pop() 
  : variantId;

// Create the working Shopify cart URL with selling plan
const shopifyCartUrl = `https://southland-organics.myshopify.com/cart/clear?return_to=/cart/add?items[][id]=${numericVariantId}%26items[][quantity]=${quantity}%26items[][selling_plan]=${sellingPlan}%26return_to=/checkout`;
---

<a 
  href={shopifyCartUrl}
  class={`shopify-product-buy-button ${buttonClasses} no-underline`}
>
  <span class="button-text">
    {loading ? 'Processing...' : text}
  </span>
  
  {loading ? (
    <svg class="animate-spin -mr-1 ml-3 h-5 w-5 text-current" fill="none" viewBox="0 0 24 24">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 714 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
    </svg>
  ) : (
    <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m-2.4 0L3 3H1m6 10v6a1 1 0 001 1h8a1 1 0 001-1v-6m-9 0V7a1 1 0 011-1h6a1 1 0 011 1v6"></path>
    </svg>
  )}
</a>


<style>
  .shopify-product-buy-button:hover {
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    text-decoration: none;
  }
  
  .shopify-product-buy-button {
    text-decoration: none;
  }
</style>