---
import ShopifyBuyButton from './ShopifyBuyButton.astro';
import { getProduct, mockProduct, isShopifyConfigured, getDefaultVariant, formatPrice } from '../lib/shopify';

// Fetch product data (will use mock data if Shopify not configured)
let product = mockProduct;
let defaultVariant = getDefaultVariant(mockProduct);

if (isShopifyConfigured()) {
  try {
    const shopifyProduct = await getProduct();
    if (shopifyProduct) {
      product = shopifyProduct;
      defaultVariant = getDefaultVariant(shopifyProduct);
    }
  } catch (error) {
    console.warn('Failed to fetch Shopify product, using mock data:', error);
  }
}

const productPrice = defaultVariant?.price.amount || '84.00';
const formattedPrice = formatPrice(productPrice);
const variantId = defaultVariant?.id || '';
---

<section id="pricing" class="py-20 bg-gray-50">
  <div class="container mx-auto px-4">
    <div class="max-w-6xl mx-auto">
      
      <div class="text-center mb-16">
        <h2 class="text-4xl md:text-5xl font-bold text-gray-900 mb-6">
          Only <span class="text-green-600">{formatPrice((parseFloat(productPrice) / 3).toString())}</span> Per Treatment vs <span class="text-red-600">$15,000+</span> Disaster
        </h2>
        <p class="text-xl text-gray-600 max-w-3xl mx-auto">
          Just 3 treatments a year keep your septic system worry-free. Each bottle delivers powerful microbial action for reliable, natural maintenance that won't break the bank.
        </p>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-16">
        
        <div class="bg-white rounded-2xl shadow-lg border-2 border-red-200 overflow-hidden">
          <div class="bg-red-50 border-b border-red-200 px-8 py-6">
            <h3 class="text-2xl font-bold text-red-800 text-center">
              Without Pour the PORT
            </h3>
            <p class="text-red-600 text-center mt-2">
              The true cost of septic system failures
            </p>
          </div>
          
          <div class="p-8">
            <div class="space-y-4">
              <div class="flex justify-between items-center py-3 border-b border-gray-100">
                <span class="text-gray-700">Complete System Replacement</span>
                <span class="text-2xl font-bold text-red-600">$15,000+</span>
              </div>
              <div class="flex justify-between items-center py-3 border-b border-gray-100">
                <span class="text-gray-700">Emergency Pumping (multiple)</span>
                <span class="text-xl font-bold text-red-600">$3,500+</span>
              </div>
              <div class="flex justify-between items-center py-3 border-b border-gray-100">
                <span class="text-gray-700">Property Damage Cleanup</span>
                <span class="text-xl font-bold text-red-600">$8,000+</span>
              </div>
              <div class="flex justify-between items-center py-3 border-b border-gray-100">
                <span class="text-gray-700">Permits & Inspections</span>
                <span class="text-lg font-bold text-red-600">$1,200+</span>
              </div>
              <div class="flex justify-between items-center py-3 border-b border-gray-100">
                <span class="text-gray-700">Temporary Housing</span>
                <span class="text-lg font-bold text-red-600">$2,500+</span>
              </div>
              <div class="flex justify-between items-center py-3">
                <span class="text-gray-700">Lost Work Time</span>
                <span class="text-lg font-bold text-red-600">$1,500+</span>
              </div>
            </div>
            
            <div class="border-t-2 border-red-200 mt-6 pt-6">
              <div class="flex justify-between items-center">
                <span class="text-xl font-bold text-gray-900">Total Potential Cost:</span>
                <span class="text-4xl font-bold text-red-600">$31,700+</span>
              </div>
              <p class="text-red-600 text-center mt-4 font-medium">
                Plus years of stress, health risks, and property devaluation
              </p>
            </div>
          </div>
        </div>

        <div class="bg-white rounded-2xl shadow-xl border-2 border-green-400 overflow-visible relative">
          <div class="absolute -top-3 left-1/2 transform -translate-x-1/2 z-10">
            <div class="bg-green-500 text-white px-6 py-2 rounded-full font-bold text-sm shadow-lg">
              BEST VALUE
            </div>
          </div>
          
          <div class="bg-green-50 border-b border-green-200 px-8 py-6 mt-4">
            <h3 class="text-2xl font-bold text-green-800 text-center">
              With Pour the PORT
            </h3>
            <p class="text-green-600 text-center mt-2">
              Natural maintenance that saves thousands
            </p>
          </div>
          
          <div class="p-8">
            <div class="text-center mb-8">
              <div class="text-6xl font-bold text-green-600 mb-2">{formatPrice((parseFloat(productPrice) / 3).toString())}</div>
              <div class="text-lg text-gray-600">per treatment</div>
              <div class="text-sm text-gray-500">Just 3 times a year • {formattedPrice} total annual cost</div>
            </div>
            
            <div class="space-y-4 mb-8">
              <div class="flex items-center">
                <svg class="w-5 h-5 text-green-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <span class="text-gray-700">USDA Certified Biobased® treatment</span>
              </div>
              <div class="flex items-center">
                <svg class="w-5 h-5 text-green-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <span class="text-gray-700">Prevents costly system failures</span>
              </div>
              <div class="flex items-center">
                <svg class="w-5 h-5 text-green-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <span class="text-gray-700">Safe for family, pets & environment</span>
              </div>
              <div class="flex items-center">
                <svg class="w-5 h-5 text-green-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <span class="text-gray-700">Trusted by National Parks 10+ years</span>
              </div>
              <div class="flex items-center">
                <svg class="w-5 h-5 text-green-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <span class="text-gray-700">Simple 3-step application process</span>
              </div>
              <div class="flex items-center">
                <svg class="w-5 h-5 text-green-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <span class="text-gray-700">Peace of mind protection</span>
              </div>
            </div>

            <ShopifyBuyButton 
              variantId={variantId}
              quantity={1}
              text={`Get 3 Treatments - ${formattedPrice}`}
              class="w-full text-center"
              size="lg"
              style="primary"
            />
            
            <p class="text-center text-gray-500 text-sm mt-4">
              30-day money-back guarantee
            </p>
          </div>
        </div>

      </div>

      <div class="bg-gradient-to-r from-yellow-50 to-orange-50 border border-yellow-200 rounded-2xl p-8 md:p-12 mb-12">
        <div class="text-center mb-8">
          <h3 class="text-3xl font-bold text-gray-900 mb-4">
            Break Down the Numbers
          </h3>
          <p class="text-lg text-gray-600">
            See exactly how much Pour the PORT saves you every single day
          </p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 text-center">
          <div class="bg-white rounded-lg p-6 shadow-md">
            <div class="text-3xl font-bold text-green-600 mb-2">{formatPrice((parseFloat(productPrice) / 365).toString())}</div>
            <div class="text-sm text-gray-600 uppercase font-semibold">Per Day</div>
            <div class="text-xs text-gray-500 mt-1">Less than a cup of coffee</div>
          </div>
          
          <div class="bg-white rounded-lg p-6 shadow-md">
            <div class="text-3xl font-bold text-blue-600 mb-2">{formatPrice((parseFloat(productPrice) / 12).toString())}</div>
            <div class="text-sm text-gray-600 uppercase font-semibold">Per Month</div>
            <div class="text-xs text-gray-500 mt-1">Less than lunch out</div>
          </div>
          
          <div class="bg-white rounded-lg p-6 shadow-md">
            <div class="text-3xl font-bold text-purple-600 mb-2">{formatPrice((parseFloat(productPrice) / 3).toString())}</div>
            <div class="text-sm text-gray-600 uppercase font-semibold">Per Treatment</div>
            <div class="text-xs text-gray-500 mt-1">4 months protection</div>
          </div>
          
          <div class="bg-white rounded-lg p-6 shadow-md">
            <div class="text-3xl font-bold text-orange-600 mb-2">{Math.round(31700 / parseFloat(productPrice))}x</div>
            <div class="text-sm text-gray-600 uppercase font-semibold">ROI Potential</div>
            <div class="text-xs text-gray-500 mt-1">{formattedPrice} vs $31,700 disaster</div>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-2xl shadow-xl p-8 md:p-12">
        <div class="text-center mb-8">
          <h3 class="text-3xl font-bold text-gray-900 mb-4">
            Frequently Asked Pricing Questions
          </h3>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
          <div>
            <h4 class="text-lg font-bold text-gray-900 mb-3">
              Q: Why is annual supply the best value?
            </h4>
            <p class="text-gray-600 mb-6">
              Buying annually ensures you never miss a treatment and get the lowest per-application cost. 
              Plus, you're covered for emergency situations when septic problems typically occur.
            </p>
            
            <h4 class="text-lg font-bold text-gray-900 mb-3">
              Q: What if I only treat once a year?
            </h4>
            <p class="text-gray-600">
              While one treatment is better than none, our research with National Parks shows 
              3x annually provides optimal protection. Missing treatments leaves gaps where problems can develop.
            </p>
          </div>
          
          <div>
            <h4 class="text-lg font-bold text-gray-900 mb-3">
              Q: How does this compare to pumping costs?
            </h4>
            <p class="text-gray-600 mb-6">
              Regular pumping costs $300-500 every 3-5 years. Pour the PORT extends time between pumpings 
              while preventing the buildup that leads to expensive failures.
            </p>
            
            <h4 class="text-lg font-bold text-gray-900 mb-3">
              Q: Is there a money-back guarantee?
            </h4>
            <p class="text-gray-600">
              Yes! 30-day money-back guarantee. If you're not satisfied with Pour the PORT 
              for any reason, we'll refund your purchase completely.
            </p>
          </div>
        </div>
      </div>

      <div class="text-center mt-12">
        <div class="bg-red-50 border border-red-200 rounded-lg p-6 mb-8 inline-block">
          <div class="flex items-center text-red-800">
            <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <span class="font-bold">Don't wait for disaster to strike</span>
          </div>
          <p class="text-red-600 mt-2">
            Most septic failures happen suddenly, often during holidays or bad weather when emergency services cost the most.
          </p>
        </div>
        
        <ShopifyBuyButton 
          variantId={variantId}
          quantity={1}
          text={`Start for Just ${formatPrice((parseFloat(productPrice) / 3).toString())} Today`}
          size="xl"
          style="primary"
        />
      </div>

    </div>
  </div>
</section>